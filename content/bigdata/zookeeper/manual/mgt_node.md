---
title: "节点管理"
description: 本小节主要介绍如何管理 ZooKeeper 集群节点。 
keyword: ZooKeeper 在线伸缩,节点管理
weight: 15
collapsible: false
draft: false
---

目前 ZooKeeper 支持创建 ZooKeeper 的参与者节点，参与者节点是指参与投票选举的节点，包括 Leader、Follower、单节点 Standalone 三种服务模式。为了确保集群可以正常工作，通常需要保证有足够多的参与者节点，这样当某个或某几个节点坏掉以后，参与者的数量 （Quorum） 还可以保证选举出 Leader 。

> **注意**
> 
> 增加参与者节点会影响 ZooKeeper 的写性能。因为写操作需要得到 Quorum 对 Leader 的一致同意才能进行，参与者越多所需的协商时间越长。建议不要创建过多集群参与者节点。
> 
> 暂不支持创建观察者节点。

本小节主要介绍如何管理集群节点，包括增加、删除、扩容节点。

## 约束限制

- 支持最多创建 9 个节点 。
- 若 ZooKeeper 集群在单个区域，建议最多创建5个参与者节点；若跨多个区域，建议最多创建9个参与者节点。
- 新增节点数必须为偶数，每次至少可增加两个。
- 不支持删除主节点。

## 前提条件

- 已获取管理控制台登录账号和密码，且已获取集群操作权限。
- 已创建 ZooKeeper 集群，且集群状态为**活跃**。

## 增加节点

当 ZooKeeper 需增加节点以适应客户端逐步增多带来的压力时，可以在 AppCenter 管理控制台增加 ZooKeeper 节点。

1. 登录管理控制台。
2. 选择**产品与服务** > **大数据服务** > **ZooKeeper 服务**，进入集群管理页面。
3. 选择目标集群，点击目标集群 ID，进入集群详情页面。
4. 在**节点**页签，点击**新增节点**，弹出节点配置窗口。

   <img src="../../_images/add_node.png" alt="增加节点" style="zoom:50%;" />

5. 配置节点信息。

6. 点击**提交**，返回节点列表页面。

   待集群状态切换为**活跃**，即节点添加完毕。

## 删除节点

当客户端连接并不多的时候，可删除 ZooKeeper 节点，以节省资源和费用。

删除节点过程中会锁定 ZooKeeper 集群，节点状态将切换为**更新中**，不支持集群其他生命周期操作。

> **注意**
> 
> 删除节点是危险的操作，请谨慎操作。
> 
> 为避免数据丢失，请选中从节点删除。

1. 在**节点**页签，勾选目标节点。

   > **说明**
   >
   > 删除节点数只能为偶数，建议每次删除两个。若需删除更多个节点，需等到上一次节点删除后才能删除下一次节点，否则将导致数据会丢失。

2. 点击**删除**，弹出节点删除确认窗口。

   <img src="../../_images/delete_node.png" alt="删除节点" style="zoom:50%;" />

3. 点击**确认**，返回节点列表页面。

   待集群状态切换为**活跃**，即节点删除完毕。

## 纵向伸缩

由于 ZooKeeper 的每个节点都有数据的全拷贝，并且数据都是要装载在内存里，所以当业务存放在 ZooKeeper 里的数据量增大到一定程度的时候，不可避免需要纵向扩容每个节点的内存。反之，如果节点的 CPU、内存使用并不大，可以降低配置。

> **注意**
> 
> 在缩小内存的时候选择新配置的内存要大于节点内数据的量，否则 ZooKeeper 服务会启动异常。

1. 在集群详情页面，点击**基本属性**模块下拉菜单栏。
2. 展开菜单栏，点击**扩容集群**，弹出扩容集群配置窗口。
3. 配置待扩容集群信息。

    配置节点 CPU、内存和磁盘大小。

    <img src="../../_images/scale_up_down.png" alt="扩容节点" style="zoom:50%;" />

4. 点击**提交**，返回集群详情页面。

   待节点状态切换为**活跃**，即扩容完毕。
