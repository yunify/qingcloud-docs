---
title: "通过 SNAT 实现云服务器访问公网"
descriptipn: 通过NAT网关的 SNAT 功能云服务器访问公网。
draft: false
weight: 10
keyword: QingCloud, 青云, NAT网关, NAT, SNAT, DNAT
---

当云服务器在没有绑定公网 IP 的情况下需要访问公网，为了节省公网 IP 资源并且避免云服务器 IP直接暴露在公网上，可以通过 NAT 网关共享公网 IP 的方式访问公网。

## 操作场景

假设某公司在青云平台创建了 VPC 网络和私有网络，私有网路中创建了多个云服务器。云服务器均未绑定公网 IP。因公司业务需要，每台服务器需要能够访问公网。

此时通过 NAT 网关的 SNAT 功能，即可使 VPC 内无公网 IP 的云服务器可以通过 NAT 网关访问公网。

## 前提条件

- 已注册青云账号并完成实名认证。
- 已创建 VPC 网络。具体操作，请参见[创建 VPC 网络](/network/vpc/manual/vpcnet/10_create_vpc/)。


- 确保已创建的 VPC 网络中不存在目标网段为 0.0.0.0/0 的自定义路由。如果存在，请删除该路由条目。

## 配置流程

![](../../_images/snat_qs.svg)

## 操作步骤

### 步骤1：创建 NAT 网关

1. 登录 [QingCloud 管理控制台](https://console.qingcloud.com/login)，在控制台导航栏中，选择**产品与服务** > **网络服务** > **NAT 网关**，进入 **NAT 网关**页面。

2. 点击**创建**，进入**创建 NAT 网关**页面。

   ![](../../_images/create_natgw.png)

3. 配置 NAT 网关信息。

   对于 NAT 网关的各项配置参数更详细的说明，可参见[创建 NAT 网关](../../manual/mge_nat/create_nat/)。

   - **区域**：NAT 网关的部署区域。
   - **名称**：NAT 网关的名称。
   - **VPC 网络**：选择 NAT 网关所属的 VPC。创建 NAT 网关后，不能修改 NAT 网关所属的 VPC。
   - **规格**：不同规格的 NAT 网关会影响 SNAT 最大连接数和 SNAT 每秒新建连接数，但不会影响 DNAT 性能。请您根据业务需求灵活选择规格。规格性能数据请参考 [NAT 网关规格](../../intro/specification/)。
   - **部署方式**：NAT 网关节点部署方式。**多可用区部署**表示节点分散部署在不同可用区，可用性更高；**单可用区部署**表示节点部署在指定的同一可用区，网络延迟最低。
   - **可用区**：选择单可用区部署方式时，需要指定部署在哪个可用区。
   - **公网 IP**：若已有，则选择**使用已有**，并选择要使用的公网 IP；若无，则选择**购买并绑定**，然后设置计费模式、带宽上限及 IP 组信息。
   - **安全组**：选择 NAT 网关的安全组。若未创建安全组，可选择默认安全组。
   - **集群模式**：选择多可用区部署方式时，需要选择 NAT 网关节点的集群模式。**低延时**表示网络流量会优先传输到距离最近的 NAT 网关节点上；**单高吞吐**表示网络流量会均衡地传输到所有的 NAT 网关节点上。

4. 点击**立即创建**。等待创建完成，

### 步骤2：配置 NAT 网关路由

>**说明**
>
>- 若 NAT 网关关联的 VPC 为2021年10月XX日之后新建的 VPC，则创建 NAT 网关时将自动在关联的路由表中下发指向 NAT 网关的路由，无需手动配置，请跳过本步骤，直接执行[步骤3](#步骤3添加-snat-规则)。
>- 若 NAT 网关关联的 VPC 为2021年10月XX日之前创建的已有 VPC，则参照本步骤手动配置路由规则，将私有网络流量指向 NAT 网关。

1. 在左侧导航中，选择**网络** > **路由表**。

2. 在路由表列表中，单击需要访问 Internet 的私有网络所关联的路由表 ID，进入路由表详情页。

   > **说明**
   >
   > 若私有网络还未绑定路由表，请先创建并绑定。具体操作请参见[路由表使用指导](/network/vpc/manual/routing/02_route_function/)。

3. 在**规则**页签下，点击**添加路由**。

4. 在目标网络输入框中输入规则名称及需要访问的公网 IP 地址段（如0.0.0.0/0，表示全部公网地址），下一跳选择 **NAT 网关**。

5. 点击**提交**。

6. 添加完成后，点击**应用修改**使配置生效。

### 步骤3：添加 SNAT 规则

1. 在 NAT 网关列表中，点击目标 NAT 网关的 ID 号，进入 NAT 网关详情页。

2. 在 **SNAT 规则**页签，点击**添加规则**，弹出**添加SNAT规则**窗口。

   ![](../../_images/create_snat.png)

3. 配置 SNAT 规则。
   - **名称**：SNAT条目的名称。
   - **资源类型**：选择`私有网络`。
   - **私有网络**：选择您需要上网的云服务器所在私有网络。
   - **公网 IP**：选择用来提供互联网访问的公网 IP。

4. 点击**添加**。

5. 在 NAT 网关的基本信息区域右上方点击**应用修改**使配置生效。

### 步骤4：结果验证

SNAT 规则配置成功后，您可以测试云服务器的网络连通性。

此处以 Linux 实例为例：

1. 登录私有网络下任一云服务器。

2. 执行`ping`命令，`ping`青云的域名`www.aliyun.com`验证公网连通性。 如果能接收到回复报文，表示连接成功。

   <img src="../../_images/ping.png" alt="ping" style="zoom:50%;" />

