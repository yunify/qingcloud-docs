---
title: "快速入门"
description: test
draft: false
---

快速入门部分将会介绍如何搭建常见的四种负载均衡。

* 基于HTTP 协议的负载均衡
* 基于HTTPS 协议的负载均衡
* 基于TCP 协议的负载均衡
* 基于UDP 协议的负载均衡





## 搭建基于HTTP协议的负载均衡

假设有两台主机位于基础网络中，每台主机上都已搭建好 HTTP 的 web server，监听 80 端口。 对这两台主机配置负载均衡器，搭建HTTP协议的负载均衡。

第一步：创建一个负载均衡器

首先，需要创建一个负载均衡器。在创建的对话框中，需要指定负载均衡器类型是公网还是私网。

*   公网负载均衡器需要绑定公网IP地址
*   私网负载均衡器需要选择网络ID (也可以选择私有网络 ID 里面的某个 IP 地址)

这里选择两个公网IP地址进行绑定，然后点击提交。

> 也可以在负载均衡器创建完成之后，通过 “绑定”/”解绑” 动作来动态地调整公网IP数目；
> 如果选择的负载均衡器集群是加入在某个私有网络的，可以通过网络 "加入私有网络"/"离开私有网络"来切换负载均衡器集群加入的私有网络 ID. 另外，加入私有网络时可以指定私有 IP 地址。

![](../../manual/_images/create_lb.png)

第二步：新建监听器

当负载均衡器创建完成后，需要新建一个 基于HTTP 协议的监听器。 首先，点击进入负载均衡器的详情页面，找到并点击 “创建监听器” 按钮。 如图所示，在弹出的对话框中，监听协议选择 “HTTP”，监听端口输入 “80”，负载方式选择 “轮询”，点击提交。

>添加监听器后请检查负载均衡器的防火墙规则，确保 80 端口流量可以通过，否则从外网无法访问。另外，也可以通过点击右边 “快捷方式” 里头的 “http” 协议进行快速设置

![](../../manual/_images/create_http_listener.png)

第三步：添加后端服务器

监听器添加完成之后，需要为监听器添加后端服务器。 首先，点击 HTTP 监听器下面的 “添加后端” 按钮。 在弹出的对话框中，”所在网络” 需要选择 “基础网络”， 然后从 “后端服务器” 的下拉菜单中选择我们已经配置好的 web server，”端口” 填 “80”， 然后点击提交。同理你可以添加另一台主机。

![](../../manual/_images/add_http_backend.png)

> 如果要添加私有网络主机作为后端，同样的，直接选择私有网络即可。

由于配置修改还没有被应用，所以后端服务器会显示不可用状态。 这时需要点击”创建监听器”旁边的”应用修改”按钮，使得修改生效。



> 在修改负载均衡器配置后，需要点击”应用修改”按钮使修改生效。



应用修改完成之后，后端服务器会成功被负载均衡器接管， 状态会恢复为 “活跃”。此时通过负载均衡器绑定的IP地址（例如 `http:///` ）就可以正常的访问了。

![](../../manual/_images/http_lb_view.png)

## 搭建基于HTTPS协议的负载均衡

假设 web server 主机还需要提供 HTTPS 协议的访问， 那么同样可以搭建一个 HTTPS 的负载均衡器来对 web server 进行负载均衡。 负载均衡器提供了原生的 HTTPS 协议支持，即后端主机只需要支持 HTTP 协议即可。 如果希望由后端主机承担 HTTPS 的卸载，那么可以通过 TCP 协议来实现类似的功能。

第一步：上传 SSL 服务器证书

进入负载均衡器的 “服务器证书” 页面，点击 “创建”，并将你的 “证书内容” 和 “私钥” 粘贴到对应的输入框中，点击 “提交”。 如下图所示：

>如果你需要上传证书链，也可以将所有证书链的内容粘贴于 “证书内容” 中。



[![](../../manual/_images/create_lb_server_cert.png)](../_images/create_lb_server_cert.png)

第二步：创建一个负载均衡器

因为一个负载均衡器可以新建多个监听器，所以可以在已创建的负载均衡器里添加新的监听器。因此，在本例里可以跳过第二步不再创建新的负载均衡器。

第三步：创建监听器

首先，点击进入负载均衡器的详情页面，找到并点击 “创建监听器” 按钮。 监听协议选择 “HTTPS”，监听端口选择 “443”，均衡方式选择 “轮询”， 在 “服务器证书” 处选择你上传的证书。点击提交。



>注解
>添加监听器后请检查负载均衡器的防火墙规则，确保 443 端口流量可以通过，否则从外网无法访问你的服务 你也可以通过点击右边”快速设置”里头的 “HTTPS” 协议进行快速设置。https监听器可以支持多张证书。



[![](../../manual/_images/create_https_listener.png)](../_images/create_https_listener.png)

第四步：添加后端服务器

“网络”依旧选择 “基础网络”， 然后从 “主机” 的下拉菜单中选择已经配置好的 web server，”端口” 输入“80”，然后点击提交。

![](../../manual/_images/add_http_backend.png)

同理，如果还有其他后端主机，可以通过类似的操作依次添加。 在添加完成后，点击 “应用修改” 使配置生效。

> 如果要添加私有网络主机作为后端，直接选择私有网络。


## 搭建基于TCP协议的负载均衡

假设后端主机已经支持了 HTTPS 协议，并不需要负载均衡器本身来做 SSL 的卸载，那么可以使用 TCP 协议的负载均衡方式。 除此之外，数据库等服务也可以使用 TCP 协议进行负载均衡。

第一步：创建一个负载均衡器

因为一个负载均衡器可以新建多个监听器，所以可以在已创建的负载均衡器里添加新的监听器。因此，在本例里可以跳过第二步不再创建新的负载均衡器。

第二步：创建监听器

首先，点击进入负载均衡器的详情页面，找到并点击 “创建监听器” 按钮。监听协议选择 “TCP”，监听端口选择 “443”，均衡方式选择 “轮询”， 点击提交。


>添加监听器后请检查负载均衡器的防火墙规则，确保 443 端口流量可以通过，否则从外网无法访问您的服务


![](../../manual/_images/create_tcp_listener.png)

第三步：添加后端服务器


”网络” 中选择 “基础网络”， 在 “主机” 的下拉菜单中选择已经配置好的 web server，”端口” 输入 “443”，然后点击提交。

![](../../manual/_images/add_http_backend.png)

同理，如果还有其他 HTTPS 主机，你可以通过类似的操作依次添加， 注意在添加完成之后，不要忘记点击 “应用修改” 使配置生效。

>如果要添加私有网络主机作为后端，直接选择私有网络。

## 搭建基于UDP协议的负载均衡

UDP协议多用于关注实时性而相对不注重可靠性的场景，如视频聊天和金融实时行情推送等。您可以添加一个UDP监听转发来自UDP协议的请求。

第一步：创建一个负载均衡器

因为一个负载均衡器可以新建多个监听器，所以可以在已创建的负载均衡器里添加新的监听器。因此，在本例里可以跳过第二步不再创建新的负载均衡器。

第二步：创建监听器

点击进入负载均衡器的详情页面，找到并点击 “创建监听器” 按钮。 监听协议选择 “UDP”，监听端口选择 “514”

![](../../manual/_images/create_udp_listener.png)

UDP监听也支持选择端口范围，点击“使用端口组”，端口组范围填写“6000”-“7000”

![](../../manual/_images/create_udp_listener_portgroup.png)

第三步：添加后端服务器。


>使用限制：  UDP监听的20和65535端口为系统保留端口，目前不对外开放。