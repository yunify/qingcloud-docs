---
title: "添加 HTTP 监听器"
description: 介绍如何创建HTTP监听器。
keyword: 负载均衡器,监听器,HTTP
draft: false
weight: 10
---

您可以在负载均衡器实例上添加一个 HTTP 监听器转发来自客户端的 HTTP 协议请求。

## 适用场景

HTTP 协议适用于需要对请求的内容进行识别的应用，如 Web 应用、App 服务等。

## 前提条件

已[创建负载均衡器实例](/network/loadbalancer/manual/lb/create_lb/)。

## 操作步骤

1. 登录管理控制台，选择**产品与服务** > **网络服务** > **负载均衡器**，进入**负载均衡器**页面。

2. 在负载均衡器列表，找到目标实例，点击实例 ID 号，进入实例详情页。

   <img src="../../../_images/add_monitor.png"  />

3. 在**监听器**页签，点击**创建监听器**，弹出**添加监听器**页面。

   <img src="../../../_images/add_http_monitor.png"  />

4. 配置监听器参数。

   参数说明如下表。

   | 参数             | 说明                                                         |
   | ---------------- | ------------------------------------------------------------ |
   | 名称             | 自定义监听器名称。                                           |
   | 监听协议         | 客户端与负载均衡监听器建立流量分发连接的协议。<br/>本操作中需选择 **HTTP**。 |
   | 端口             | 用来接收请求并向后端服务器转发请求的端口。<br/>取值范围为：[1-65535]。<div style="background-color: #D8ECDE; padding: 10px 24px; margin: 10px 0; border-left: 3px solid #00a971;"><b>说明</b>：<br/>添加监听器后，需要在负载均衡器所属安全组中，放行监听端口下行流量，否则从外网无法访问您的服务。</div> |
   | 负载方式         | 选择负载均衡的调度算法。<ul><li>轮询：依据后端服务器的权重，将请求轮流发送给后端服务器。 </li><li>最少连接：优先将请求发给拥有最少连接数的后端服务器。</li><li>源地址：基于源 IP 地址的一致性哈希，相同的源地址会调度到相同的后端服务器。</li></ul> |
   | **高级选项**     | 点击**显示高级选项**，进行以下高级选项配置。                 |
   | 会话保持         | 选择是否启用会话保持。启用会话保持后，负载均衡将属于同一个会话的请求都转发到同一个服务器进行处理。 |
   | 健康检查         | 设置健康检查方式及健康检查选项，以定期检查后端服务的运行状态。<br/>关于健康检查设置的详细说明，请参考[健康检查概述](/network/loadbalancer/manual/healthy/intro/)。 |
   | 场景             | 监听场景。<ul><li>默认优化：使用默认设置。 </li><li>keep-alive：通过 Connection 字段配置 Keep-Alive ，保证 HTTP 可以复用连接。</li></ul> |
   | 附加 HTTP 头字段 | 负载均衡器在转发 HTTP 请求时可以附加用户指定的 HTTP 头字段，后端服务器可以通过解析相应的头字段来获取字段内容：<ul><li>客户端真实 IP：对应的 HTTP 的头字段为 **X-Forwarded-For**。。 </li><li>负载均衡器 ID：对应的 HTTP 的头字段为 **QC-LB-ID**。</li><li>负载均衡器入口 IP：对应的 HTTP 的头字段为 **QC-LB-IP**。</li><li>负载均衡器监听协议：对应的 HTTP 的头字段为 **X-Forwarded-Proto**。</li></ul> |
   | 超时时间         | 连接请求超时时间。<br/>如果在超时时间内一直没有访问请求，负载均衡器会中断当前连接，直到下一次请求到来时再重新建立新的连接。<br/>默认 50 秒。取值范围为：10 ～ 86400 秒。 |
   | 隧道超时时间     | 通过隧道连接的超时时间。<br/>默认 3600 秒。取值范围为：10 ～ 86400 秒。 |
   | 附加选项         | <ul><li>取消 URL 验证：让负载均衡器可以接受不符合编码规范的 URL，例如包含未编码中文字符的 URL 等。</li><li>获取客户端 IP：也称为“透明代理”，启用后，后端服务器可以获取到客户端的真实 IP 地址。<div style="background-color: #D8ECDE; padding: 10px 24px; margin: 10px 0; border-left: 3px solid #00a971;"><b>说明</b>：<br/>开启此项，负载均衡器对于后端完全透明，后端云服务器 TCP 连接得到的源地址是客户端的 IP，而不是负载均衡器的 IP。开启透明代理导致内网请求失败，请在只提供公网服务（绑定了公网 IP）时开启。</div> </li><li>数据压缩：使用 gzip 算法压缩文本数据，以减少网络流量。</li><li>启用 HTTPS 重定向：将此监听器的 HTTP 请求重定向至 HTTPS 监听器。<div style="background-color: #D8ECDE; padding: 10px 24px; margin: 10px 0; border-left: 3px solid #00a971;"><b>说明</b>：<br/>启用后，此监听器不支持添加后端。</div></li><li>禁用 HTTP 头字段 Proxy：安全起见，某些后端为 CGI 的 Web 应用需要在用户请求中禁用该字段来防止注入攻击。</li></ul> |

   

5. 配置确认无误后，点击**提交**，开始创建监听器。

   创建成功后，您可以在监听器页面查看到已创建的监听器。

6. 点击**应用修改**，更新负载均衡器配置。

## 关联操作

- [添加后端服务器](/network/loadbalancer/manual/backends/manage/)

- [管理监听器](/network/loadbalancer/manual/monitor/mge_monitor/)
