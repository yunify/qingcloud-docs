---
title: "添加 TCP 监听器"
description: 介绍如何创建TCP监听器。
keyword: 负载均衡器,监听器,TCP
draft: false
weight: 20
---

您可以在负载均衡实例上添加一个 TCP 监听器转发来自客户端的 TCP 协议请求。

## 适用场景

TCP 协议适用于对可靠性和数据准确性要求高、对传输速度要求较低的场景，如文件传输、收发邮件、远程登录等。TCP 监听器绑定的后端服务器可直接获取客户端的真实 IP。

## 前提条件

已[创建负载均衡器实例](/network/loadbalancer/manual/lb/create_lb/)。

## 操作步骤

1. 登录管理控制台，选择**产品与服务** > **网络服务** > **负载均衡器**，进入**负载均衡器**页面。

2. 在负载均衡器列表，找到目标实例，点击实例 ID 号，进入实例详情页。

   <img src="../../../_images/add_monitor.png"  />

3. 在**监听器**页签，点击**创建监听器**，弹出**添加监听器**页面。

   <img src="../../../_images/add_tcp_monitor.png" />

4. 配置监听器参数。

   参数说明如下表。

   | 参数         | 说明                                                         |
   | ------------ | ------------------------------------------------------------ |
   | 名称         | 自定义监听器名称。                                           |
   | 监听协议     | 客户端与负载均衡监听器建立流量分发连接的协议。<br/>本操作中需选择 **TCP**。 |
   | 端口         | 用来接收请求并向后端服务器转发请求的端口。<br/>可以点击**使用端口组**，设置监听端口段。取值范围为：[1-65535]。<div style="background-color: #D8ECDE; padding: 10px 24px; margin: 10px 0; border-left: 3px solid #00a971;"><b>说明</b>：<br/>添加监听器后，需要在负载均衡器所属安全组中，放行监听端口下行流量，否则从外网无法访问您的服务。</div> |
   | 负载方式     | 选择负载均衡的调度算法。<ul><li>轮询：依据后端服务器的权重，将请求轮流发送给后端服务器。 </li><li>最少连接：优先将请求发给拥有最少连接数的后端服务器。</li><li>源地址：基于源 IP 地址的一致性哈希，相同的源地址会调度到相同的后端服务器。</li></ul> |
   | **高级选项** | 点击**显示高级选项**，进行以下高级选项配置。                 |
   | 健康检查     | 设置健康检查方式及健康检查选项，以定期检查后端服务的运行状态。<br/>关于健康检查设置的详细说明，请参考[健康检查概述](/network/loadbalancer/manual/healthy/intro/)。 |
   | 场景         | 监听场景。<ul><li>默认优化：默认设置，TCP 监听默认开启长连接。 </li><li>后端下线时，终止长连接：后端服务器不可用时，关闭长连接。</li></ul> |
   | 超时时间     | TCP 连接的超时时间。<br/>如果在超时时间内一直没有访问请求，负载均衡器会中断当前连接，直到下一次请求到来时再重新建立新的连接。<br/>默认 50 秒。取值范围为：10 ～ 86400 秒。 |
   | 隧道超时时间 | 通过隧道连接的超时时间。<br/>默认 3600 秒。取值范围为：10 ～ 86400 秒。 |
   | 附加选项     | <ul><li>获取客户端 IP：也称为“透明代理”，启用后，后端服务器可以获取到客户端的真实 IP 地址。<div style="background-color: #D8ECDE; padding: 10px 24px; margin: 10px 0; border-left: 3px solid #00a971;"><b>说明</b>：<br/>开启此项，负载均衡器对于后端完全透明，后端云服务器 TCP 连接得到的源地址是客户端的 IP，而不是负载均衡器的 IP，会导致内网请求失败，请在只提供公网服务（绑定了公网 IP）时开启。</div> </li><li>拒绝 TCP 连接请求：开启后，当所有后端不可用时，不再接受连接，而是直接拒绝 TCP 连接请求。</li></ul> |

   

5. 配置确认无误后，点击**提交**，开始创建监听器。

   创建成功后，您可以在监听器页面查看到已创建的监听器。

6. 点击**应用修改**，更新负载均衡器配置。

## 关联操作

- [添加后端服务器](/network/loadbalancer/manual/backends/manage/)

- [管理监听器](/network/loadbalancer/manual/monitor/mge_monitor/)
