---
title: "路由表应用示例"
keyword: VPC, VPC 网络, 路由表
description: 私有网络路由表及负载均衡器路由表应用示例。
draft: false
weight: 3
---

## 为私有网络添加路由规则

### 应用场景

用户希望私有网络“办公网络”（ 192.168.128.0/24，假设已创建 ）内的所有云服务器统一通过 NAT 网关 （ nat-00001 ）访问互联网，以实现公网 IP 地址的复用和带宽共享。

### 操作步骤

#### 步骤1. 创建路由表并绑定到私有网络

> **说明**
>
> 若私有网络在创建时已经绑定默认路由表，可跳过本步骤，直接执行[步骤2](#步骤2-创建-nat-网关并绑定公网-ip-和私有网络)。

1. 创建一个**关联资源类型**为**私有网络**的路由表。具体操作请参见[创建自定义路由表](/02_route_function/#创建自定义路由表)。

   <img src="../../../_images/504002_create_routetable.png" alt="创建路由表" style="zoom:50%;" />

2. 创建完成后，将路由表绑定到私有网络（ 192.168.128.0/24 ）。具体操作请参见[绑定路由表](../02_route_function/#绑定自定义路由表)。

#### 步骤2. 创建 NAT 网关并绑定公网 IP 和私有网络

在创建 NAT 网关时，为 NAT 网关绑定公网 IP，并加入私有网络（ 192.168.128.0/24 ）。

<img src="../../../_images/504003_create_nat.png" alt="创建NAT网关" style="zoom:45%;" />

- 若私有网络已绑定默认路由表，则 NAT 网关绑定私有网络后，将自动添加一条默认路由规则，实现私有网络中的云服务器访问公网。操作到此结束。
- 若私有网络绑定的是自定义路由表，则需要继续执行[步骤3](#3-添加路由规则)手动添加路由。

#### 步骤3. 添加路由规则

1. 在路由表规则页面，点击**添加路由**，添加一条下一跳指向 NAT 网关的路由规则。如下图所示。

   <img src="../../../_images/504003_route_to_nat.png"  style="zoom:45%;" />

   - **目标网络**：私有网络要访问的目标网络，在本示例中为所有 IP 地址，即`0.0.0.0/0` 。

   - **下一跳类型**：选择`NAT 网关`，然后在下方的下拉框中，选择[步骤2](#步骤2-创建-nat-网关并绑定公网-ip-和私有网络)中创建的NAT网关实例。

2. 添加完成后，点击**应用修改**。

## 为负载均衡器添加路由规则

### 应用场景

云服务器通过隧道访问其他 VPC 的负载均衡器。假设，用户数据中心的网络（ 192.168.10.0/24 ） 和云上 VPC 通过隧道打通（ 172.16.10.0/24 ），用户数据中心的客户端（ 192.168.10.2）希望访问位于云上 VPC 下的"公私网混合 LB"（ 172.16.10.253 ）。

### 操作步骤

#### 步骤1. 测试隧道连通情况

1. 登录客户端 192.168.10.2 ， ping 云服务器（假设 172.16.10.5 ），可以正常通信，符合预期。

   ```
   ping 172.16.10.5
   ```

   ![](../../../_images/504003_ping_vpn_instance.jpg)

2. 添加 LB 监听器和后端。

   需要确保 LB 有后端服务器，才可以被访问。

3. 客户端 ping 公私网混合 LB，无法通信，符合预期。

   ```
   ping 172.16.10.253
   ```

   ![](../../../_images/504003_ping_vpn_lb1.jpg)

#### 步骤2. 创建路由表并绑定到负载均衡器

1. 创建一个**关联资源类型**为**负载均衡器**的路由表。

   <img src="../../../_images/504003_routetable_lb.png" style="zoom:50%;" />

2. 创建完成后，将路由表绑定到负载均衡器（ 172.16.10.253 ）。

#### 步骤3. 添加路由表规则

1. 在路由表规则页面，点击**添加路由**，添加路由规则。如下图所示。

   <img src="../../../_images/504003_lb_routerules.png"  style="zoom:45%;" />

   - **目标网络**：希望资源能够访问的 IP 网络，即 LB 要访问的目标网络，在本示例中为 `192.168.10.0/24` 。

   - **下一跳类型**： 路由器，默认为 LB 所在的 VPC 网络路由器。

2. 添加完成后，点击**应用修改**。

#### 步骤4. 验证客户端是否能连通公私网混合 LB

在客户端 ping 公私网混合 LB，此时可以正常通信。

```
 ping 172.16.10.253
```

![](../../../_images/504003_ping_vpn_lb2.jpg)

