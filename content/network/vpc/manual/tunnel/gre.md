---
title: "GRE 隧道应用示例"
description: 介绍 GRE 隧道的使用操作。
keyword: VPC, VPC 网络, GRE 隧道
draft: false
weight: 20

---

本文以 VPC 与本地数据中心常见的几种连接场景为例，介绍如何使用 GRE 隧道建立 VPC 与本地数据中心的连接。

## VPC 与单个数据中心连接

以下图场景为例，假设您在云上的 VPC 使用的公网 IP 是 3.3.3.3，您本地数据中心的网络使用的公网 IP 是 6.6.6.6，这两个网络节点下各连接有两个私有网络（子网），它们将通过 GRE 隧道连接在一起。

![](/network/vpc/_images/gre_l3_p2p.gif)

### 步骤1：在 VPC 端配置隧道规则

1. 登录管理控制台，选择**产品与服务** > **网络服务** > **VPC 网络**，进入 VPC 列表页面。

2. 找到您的 VPC 网络，点击 VPC 网络名称，进入详情页。

3. 在 VPC 详情页的**管理配置**页签，选择**隧道服务**。

   ![](/network/vpc/_images/tunnel_service.png)

4. 点击**添加隧道规则**，弹出**添加隧道规则**窗口。

5. 配置以下参数，添加一条 GRE 隧道。

   <img src="/network/vpc/_images/gre_l3_add_static.png" alt="添加隧道规则" style="zoom:50%;" />

   参数详细说明，请参见 [GRE 隧道参数说明](../mge_tunnel_rule/#gre-隧道参数)。

   * 名称：为该隧道起个名字，比如 tun36。
   * 远端路由器：数据中心路由器的公网 IP 或域名，如本例中为 6.6.6.6。
   * 协议：选择 GRE 协议。
   * 密钥：两端共同使用的约定整型数字，比如 12345。
   * 本地点对点 IP：隧道在 VPC 端的地址，比如 10.254.0.1。
   * 对端点对点 IP：隧道在您数据中心的地址，比如 10.254.0.2。
   * 目标网络：在本例中为您数据中心的两个私有网络 192.168.5.0/24、192.168.6.0/24。

6. 点击**提交**，返回**隧道服务**页面。

   <img src="/network/vpc/_images/gre_l3_statics.png"  style="zoom:50%;" />

7. 点击页面上方的**应用修改**，完成 VPC 网络的配置更新。

8. 前往 VPC 使用的安全组规则中放开 GRE 协议，添加规则后点击**应用修改**使之生效。

   ![](/network/vpc/_images/gre_sg_rule.png)

### 步骤2：在数据中心配置隧道规则

因隧道的对称性，您还需要在自己数据中心的路由器上进行隧道配置，具体配置方法取决于您使用的网络设备，请查询厂商的手册。

以下为 Huawei 路由器的配置过程，供参考:

```
[Quidway] interface Tunnel 0/0/0
[Quidway-Tunnel0/0/0] ip address 10.254.0.2 255.255.255.0
[Quidway-Tunnel0/0/0] tunnel-protocol gre
[Quidway-Tunnel0/0/0] source 6.6.6.6
[Quidway-Tunnel0/0/0] destination 3.3.3.3
[Quidway-Tunnel0/0/0] gre key 12345
[Quidway-Tunnel0/0/0] quit
[Quidway] ip route-static 192.168.1.0 255.255.255.0 Tunnel0/0/0
[Quidway] ip route-static 192.168.2.0 255.255.255.0 Tunnel0/0/0
```

## VPC 作为中心节点与多数据中心连接

以下图场景为例，假设您在公有云中的 VPC 网络使用的公网 IP 是 3.3.3.3，您自己有两个数据中心，它们对外使用的公网 IP 分别是 6.6.6.6、9.9.9.9，这三个网络节点各自连接有两个私有网络（子网）。因业务需要，VPC 需要与两个数据中心实现互通。此时，您可以通过 L3 GRE 隧道建立三者之间的连接。

下图中，黑色的路由器表示是 VPC 中心节点，蓝色的路由器表示接入的数据中心节点。

![](/network/vpc/_images/gre_l3_star.gif)

### 步骤1：在 VPC 端配置隧道规则

1. 找到您的 VPC 网络，点击 VPC 网络名称，进入详情页。

2. 在 VPC 详情页的**管理配置**页签，选择**隧道服务**。

   ![](/network/vpc/_images/tunnel_service.png)

3. 点击**添加隧道规则**，弹出**添加隧道规则**窗口。

4. 配置以下参数，创建一条到 6.6.6.6 的隧道，然后点击**提交**。

   <img src="/network/vpc/_images/gre_l3_add_static.png" alt="添加隧道规则" style="zoom:50%;" />

   参数详细说明，请参见 [GRE 隧道参数说明](../mge_tunnel_rule/#gre-隧道参数)。

   - 名称：为该隧道起个名字，比如 tun36。
   - 远端路由器：数据中心路由器的公网 IP 或域名，如本例中为 6.6.6.6。
   - 协议：选择 GRE 协议。
   - 密钥：两端共同使用的约定整型数字，比如 12345。
   - 本地点对点 IP：隧道在 VPC 端的地址，比如 10.254.0.1。
   - 对端点对点 IP：隧道在您数据中心的地址，比如 10.254.0.2。
   - 目标网络：在本例中为您数据中心的两个私有网络 192.168.5.0/24、192.168.6.0/24。

5. 再次点击**添加隧道规则**，新建一条到 9.9.9.9 的隧道，点击**提交**。

   <img src="/network/vpc/_images/gre_l3_add_static_2.png" alt="添加隧道规则"  />

   * 名称：隧道名称，如本例中为 tun39。
   * 远端路由器：数据中心路由器的公网 IP 或域名，如本例中为 9.9.9.9。
   * 协议：选择 GRE 协议。
   * 密钥：两端共同使用的约定整型数字，比如 12345。
   * 本地点对点 IP：隧道在 VPC 端的地址，比如 10.254.0.1。
   * 对端点对点 IP：隧道在您数据中心的地址，比如 10.254.0.2。
   * 目标网络：在本例中为您数据中心的两个私有网络 172.19.1.0/24、172.19.2.0/24。

6. 点击页面上方的**应用修改**，以完成 VPC 网络的配置更新。

7. 前往 VPC 使用的安全组规则中放开 GRE 协议，添加规则后点击**应用修改**使之生效。

   ![](/network/vpc/_images/gre_sg_rule.png)

### 步骤2：在数据中心配置隧道规则

因隧道的对称性，还需要您在自己数据中心的网络中进行相应的隧道配置，即需要在两个数据中心的路由器中分别创建到 VPC 的隧道。具体配置方法取决于您使用的网络设备，请查询厂商的手册。

## VPC 作为接入节点与数据中心连接

以下图场景为例，用户数据中心 1（ 6.6.6.6 ）作为中心节点，云平台（3.3.3.3）及用户数据中心 2（9.9.9.9）作为接入点，形成星型拓扑。现需要配置 GRE 隧道实现用户数据中心1 与 VPC 和另一数据中心互通。

![](/network/vpc/_images/gre_l3_star_2.gif)

1. 参照 [VPC 与单个数据中心连接](#vpc-与单个数据中心连接)中[步骤1](/network/vpc/manual/tunnel/gre/#步骤1在-vpc-端配置隧道规则)，创建一条到数据中心 1（6.6.6.6） 的隧道，即完成了在云平台中的操作。

2. 在数据中心 1 的路由器中配置到 VPC 的隧道以及到数据中心 2 的隧道。

   具体配置方法取决于您使用的网络设备，请查询厂商的手册。

3. 在数据中心 2 的路由器中配置到 数据中心 1 的隧道。

   具体配置方法取决于您使用的网络设备，请查询厂商的手册。



