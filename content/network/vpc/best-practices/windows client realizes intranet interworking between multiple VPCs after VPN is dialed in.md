---
title: "windows客户端实现拨入vpn后，实现跨多个vpc之间的内网互通"
linkTitle: "windows客户端实现拨入vpn后，实现跨多个vpc之间的内网互通"
date: 2021-02-16T10:08:56+09:00
description:
draft: false
weight: 1
---

## 项目介绍

客户的两个vpc之间通过ipsec或者gre隧道打通了私有网络，希望本地拨入vpc A 能同时与vpc B的私有网络互通，具体拓扑如下

<img src="../homer/build_gre_tunnel_05.png" width="60%" height="100%">

### 1.以下环境配置如下

```
vpc A

资源id :  rtr-d5651a81

内网 IP:   10.140.68.224

私有网络  172.20.100.0/24  

vpc B

资源id :  rtr-0qtg9gh8

内网 IP:   10.140.67.101

私有网络  172.21.100.0/24

```

### 2.vpc A与 vpc B之间通过gre隧道打通，配置步骤（略）

```
172.20.0.0/16<==>172.21.0.0/16
```

### 3.VPC A配置openvpn，并配置路由推送，如图所示

<img src="../homer/build_gre_tunnel_07.png" width="60%" height="100%">

```
push "route 172.21.0.0 255.255.0.0"
```

### 4.本地拨入vpn以后，检查一下路由是否推送成功，如图所示

<img src="../homer/build_gre_tunnel_06.png" width="60%" height="100%">

### 5.实测可以同时ping通两个私有网络的主机了，如图所示

```
C:\Users\myhomer>ping 172.20.100.20
 
正在 Ping 172.20.100.20 具有 32 字节的数据:
来自 172.20.100.20 的回复: 字节=32 时间=24ms TTL=62
来自 172.20.100.20 的回复: 字节=32 时间=25ms TTL=62
来自 172.20.100.20 的回复: 字节=32 时间=25ms TTL=62
来自 172.20.100.20 的回复: 字节=32 时间=25ms TTL=62
 
172.20.100.20 的 Ping 统计信息:
数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
最短 = 24ms，最长 = 25ms，平均 = 24ms
 
C:\Users\myhomer>ping 172.21.100.2
 
正在 Ping 172.21.100.2 具有 32 字节的数据:
来自 172.21.100.2 的回复: 字节=32 时间=25ms TTL=61
来自 172.21.100.2 的回复: 字节=32 时间=26ms TTL=61
来自 172.21.100.2 的回复: 字节=32 时间=25ms TTL=61
来自 172.21.100.2 的回复: 字节=32 时间=27ms TTL=61
 
172.21.100.2 的 Ping 统计信息:
数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
最短 = 25ms，最长 = 27ms，平均 = 25ms
 
C:\Users\myhomer>
```







