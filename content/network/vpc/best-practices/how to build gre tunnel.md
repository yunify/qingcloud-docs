---
title: "青云公有云在不同的可用区搭建gre隧道"
linkTitle: "青云公有云在不同的可用区搭建gre隧道"
date: 2021-02-16T10:08:56+09:00
description:
draft: false
weight: 1
---

## 项目介绍

客户的业务已部署在青云的公有云，随着客户业务不断发展，青云支撑客户在异地的公有云的部署，并且实现客户异地之间的 VPC 私有网络打通，依托于 QingCloud 动态多线 BGP 网络资源优势保证客户既能正常访问互联网又解决了客户与异地数据中心的实时通信。
如下图所示，假如您在青云已有的业务 VPC1 要与上海的已有业务 VPC2 网络进行实时通信，通过内网之间分别与动态 BGP 出口直连建立 GRE 隧道连接在一起，实现与 VPC2 的业务通信。业务拓扑如下

<img src="../homer/build_gre_tunnel.png" width="60%" height="100%">

vpc1基本信息如下                                                          

- 公网ip:139.198.14.199
- 资源id:rtr-2803sfzh
- 子网：192.168.10.0/24
- 区域：pek3

vpc2基本信息

- 公网ip:139.198.12.195

- 资源id:rtr-xxqqwifd
- 子网：192.168.20.0/24
- 区域:pek3a

## 操作步骤如下

### 1.在青云控制台pek3中的操作

登录 WEB 控制台---网络与CDN---vpc网络---详情界面---配置管理---隧道服务---添加隧道规则
在弹出的对话框里，填写以下项目:

- 协议: 默认为 GRE 协议
- 名称: 为该隧道起个名字，比如 tun1
- 远端路由器 IP: vpc2的公网 IP 139.198.12.195
- 密钥: 一个两端共同使用的约定整型数字，比如 12345，有效范围为 [1, 2^32 -1]
- 本地点对点 IP: 隧道在vpc1这边的地址，比如 10.254.0.1
- 对端点对点 IP: 隧道在成品vpc2这边的地址，比如 10.254.0.2
- 目标网络: 在本例中为vpc2的私有网络 192.168.20.0/24

可以参考截图

<img src="../homer/build_gre_tunnel_01.png" width="60%" height="100%">

### 2.在青云控制台pek3a中的操作

登录 WEB 控制台---网络与CDN---vpc网络---详情界面---配置管理---隧道服务---添加隧道规则
在弹出的对话框里，填写以下项目:

- 协议: 默认为 GRE 协议
- 名称: 为该隧道起个名字，比如 tun2
- 远端路由器 IP: vpc2的公网 IP 139.198.14.199
- 密钥: 一个两端共同使用的约定整型数字，比如 12345，有效范围为 [1, 2^32 -1]
- 本地点对点 IP: 隧道在vpc2这边的地址，比如 10.254.0.2
- 对端点对点 IP: 隧道在成品vpc1这边的地址，比如 10.254.0.1
- 目标网络: 在本例中为vpc1的私有网络 192.168.10.0/24

可以参考截图

<img src="../homer/build_gre_tunnel_02.png" width="60%" height="100%">



### 3.隧道两边vpc网络的防火墙均放行下行gre协议，并应用修改防火墙

<img src="../homer/build_gre_tunnel_03.png" width="60%" height="100%">

### 4.测试连通性，使用192.168.10.2主机去ping一下192.168.20.2这个主机，结果如图

<img src="../homer/build_gre_tunnel_04.png" width="60%" height="100%">

