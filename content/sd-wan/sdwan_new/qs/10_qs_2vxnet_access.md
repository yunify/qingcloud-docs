---
title: "企业快速上云"
draft: false
collapsible: false
weight: 10
---

您可以通过建立 SD-WAN 核心网络的方式，在客户处部署光盒 CPE，并在 VPC 的私有网络中创建一个云服务器，在部署一个软件 vCPE，通过光盒 CPE 打通云平台 VPC 的私有网络的通信。

> **说明：**
>
> 光盒 CPE 设备和软件 vCPE 是两种不同的服务形态，实际作用无差异。

如下操作步骤**以 QingCloud 上创建的 VPC、私有网络、云服务器、光盒 CPE 为例**进行说明。

## 网络规划

![](../../_images/qs_connect_2_vpc.png)

## 准备工作

- 已获取 QingCloud 管理控制台的账号和密码。
- 已创建 VPC 01、Vxnet 01、VM 01。
- 已准备计算机 PC 01 。
- 光盒 CPE 01 已上电、接 WAN 口。

## 步骤一：创建连接云网

1. 登录 QingCloud 管理控制台。

3. 选择**产品与服务** > **SD-WAN** > **SD-WAN**，进入**连接云网**页面。

   <img src="../../_images/qs_cloud_network.png" style="zoom:50%;" />

4. 点击**创建连接云网**，弹出**创建连接云网**窗口。

5. 输入企业云网的**名称**和**描述**信息，并点击**创建连接云网**。

   连接云网创建完成后，当连接云网的状态为**活跃**时，说明连接云网创建成功。

## 步骤二：创建接入点

请参照如下操作步骤，创建一个光盒 CPE 接入点和一个软件 vCPE 接入点，分别为 **CPE 01** 和 **vCPE 01**。

1. 在左侧导航栏中，点击**接入点**，进入**接入点**页面。

   <img src="../../_images/qs_light_access.png" style="zoom:50%;" />

2. 点击**创建接入点**，弹出**创建接入点**窗口。

   <img src="../../_images/qs_light_access_config.png" style="zoom:50%;" />

4. 配置接入点信息，您需要关注如下信息。

   - 创建光盒 CPE 接入点
   
     - 接入点类型：选择为**光盒 II 号**。
     - 序列号：从光盒设备上获取序列号，并输入在文本框中。若需要启用高可用，需要购买两个光盒 CPE 设备，创建接入时，分别输入两个序列号。
   
   - 创建软件 vCPE 接入点
   
     接入点类型：选择为 **vCPE 虚拟机**或者 **vCPE 容器**。
   
4. 点击**立即创建**，弹出**接入点创建成功**提示窗口。

   - 若创建光盒 CPE 接入点，提示信息如下所示。

     <img src="../../_images/qs_cpe_access_success.png" style="zoom:50%;" />

   - 若创建软件 vCPE 接入点，提示信息如下所示。

     <img src="../../_images/qs_vcpe_access_success.png" style="zoom:40%;" />

6. 您需要根据提示信息，完成相应配置工作。

6. 获取后续配置信息后，点击**知道了**，完成接入点创建。

## 步骤三：部署光盒CPE/软件vCPE 

- 光盒 CPE 设备。

  请确保光盒设备已上电且接 WAN 口。

  若需要启用高可用，添加备用设备，请绑定序列号激活设备，详细操作请参见[添加备设备](../../open_access_point/lightbox/60_bind_serial_no/)。

- 软件 vCPE

  部署软件 vCPE，详细操作请参见[部署软件 vCPE](../../open_access_point/vcpe/40_deploy_script/)。

  若需要启用高可用，添加备用设备，请参照[部署软件 vCPE](../../open_access_point/vcpe/40_deploy_script/)，将软件 vCPE 部署在备用设备上。

## （可选）步骤四：配置光盒CPE/软件vCPE

若在创建 **vCPE 01** 和 **CPE 01** 接入点时，已经配置光盒 CPE /软件 vCPE 的 LAN 网段、网关地址，并启动 DHCP 服务，则该步骤可跳过。

1. 在左侧导航栏中，点击**接入点**，进入**接入点**页面。

2. 在配置的接入点所在行的操作列中，点击**设备管理**，进入**设备管理**页面。

3. 选择**设备管理** > **LAN 配置**，进入 **LAN 配置**页面。

   <img src="../../_images/qs_light_lan.png" style="zoom:50%;" />

4. 点击**修改**，配置光盒的 LAN 网段、网关地址，并启动 DHCP 服务。

5. 点击**确定修改**，完成 LAN 的配置操作。

5. 点击**应用修改**，使修改生效。

## 步骤五：配置云服务器静态路由

为私有网络中的云服务器 **VM 01** 配置静态路由。

如下以青云QingCloud 的云服务器为例进行说明。

1. 选择**网络** > **VPC 网络**，进入 **VPC 网络**页面。

   <img src="../../_images/qs_vcpe_vpc_list.png" style="zoom:50%;" />

2. 点击 **VPC 01** 的名称，进入 **VPC 01** 的私有网络页面。

3. 选择**管理配置** > **路由推送**，进入**路由推送**页面。

   <img src="../../_images/qs_vcpe_vm_route.png" style="zoom:50%;" />

4. 点击**添加云服务器路由**，弹出**添加云服务器路由**窗口。

   <img src="../../_images/qs_config_ecs_route.png" style="zoom:50%;" />

   参数说明，如下表所示。

   | 参数     | 参数说明                                                     |
   | -------- | ------------------------------------------------------------ |
   | 名称     | 输入云服务器路由的名称。                                     |
   | 私有网络 | 选择云服务器所在的私有网络。                                 |
   | 实例 ID  | 选择要添加路由规则的云服务器 ID。                            |
   | 默认路由 | 云服务器的默认路由 IP。您可以根据自己的需要指定云服务器的默认路由 IP。 |
   | 静态路由 | 点击**添加静态路由**。<br />**目标网络**填写 **客户总部** 的 IP 段，例如：172.17.0.0/16。<br />**路由 IP** 填写 **vCPE 01**的 IP 地址，例如：192.168.128.2。 |
   
5. 填写完成后，点击 <img src="../../_images/icon_right.png" style="zoom:40%;" />，然后点击**提交**，完成 **VM 01** 静态路由的配置。

6. 点击右上角的**应用修改**，使配置生效。

## 步骤六：通过BGP将私有网络通告

1. 在左侧导航栏中，点击**接入点**，进入**接入点**页面。

2. 点击接入点名称，进入接入点详情页面。

3. 选择**网络管理** > **静态路由**，进入**静态路由**页面。

   <img src="../../_images/qs_vcpe_bgp_list.png" style="zoom:50%;" />

4. 点击**添加静态路由**，弹出**添加静态路由**窗口。

   <img src="../../_images/qs_vxnet_bgp.png" style="zoom:50%;" />

   参数说明，如下表所示。

   | 参数     | 参数说明                                                     |
   | -------- | ------------------------------------------------------------ |
   | 名称     | 设置静态路由的名称。                                         |
   | 目标网络 | 设置需要通过静态路由通告出去的 **vCPE 01**的私有网络，例如：**vCPE 01**通告的目标网络为 **192.168.128.0/24**。 |
   | 下一跳   | 您可以根据自己的实际环境是否设置下一跳地址。若您的 vCPE 连接了路由器，可设置下一跳地址。 |
   | 路由通告 | 开启路由通告，将私有网络通告出去。若不开启路由通告，则 vCPE 之间无法建立网络通信。 |

5. 点击**添加**，完成静态路由的添加操作。

6. 点击**应用修改**，使配置生效。

## 步骤七：验证网络连通性

1. 在控制台上方菜单栏中，选择**产品与服务** > **计算** > **云服务器**，进入**云服务器**页面。

   <img src="../../_images/qs_vcpe_vm_list.png" style="zoom:50%;" />

2. 在云服务器 **VM 01**所在行，点击 **Web 终端**，输入用户名和密码，登录到云服务器 VM 01。

3. 登录成功后，执行以下命令，ping PC 01 的 IP 地址，查看是否能 ping 通。

   **ping 172.17.0.3**

   若回显信息如下所示，则说明能 ping 通，**VM 01** 与 **PC 01** 成功打通。

   <img src="../../_images/qs_vcpe_ping_access.png" style="zoom:50%;" />
