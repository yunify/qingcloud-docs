---
title: "调整分片及副本数量"
description: 本小节介绍如何调整 Redis 分片数量来扩、缩容。
weight: 2
collapsible: false
draft: false
keywords: QingCloud，Redis Cluster，数据库，分片
---

Redis Cluster 支持通过调整分片节点的数量来达到扩、缩容的目的，操作过程中，数据会发生迁移，但不影响业务的正常运行。

## 背景信息

在 Redis 5.0.\* 及之前版本中，节点角色分为**主节点**及**主节点副本**；从 Redis 6.\* 版本起，节点角色分为**分片**及**分片副本**。其中，**主节点**即**分片**，**主节点副本**即**分片副本**，两者只是叫法不同，其含义并无差别。

本节以 Redis 6.* 版本的操作界面为例进行介绍。

## 操作场景

- Redis 集群每个分片写的能力与容量都有上限。当写的能力不满足业务需求或达到容量上限时，您可以通过增加分片来提升写性能以及容量；当写服务能力或容量过剩，也可以删除多余的分片。
- Redis 集群每个分片可以支持多个副本。当读的能力不足时，您可以通过新增副本来提升读性能；当读服务能力过剩，您也可以删除多余的副本。

## 注意事项

- 在 Redis 6.* 版本中，一个集群实例支持的分片数量为 1-50（推荐至少3），每个分片的副本数量为 0-5（推荐1）。
- 完成分片数量的调整操作后，集群状态立即转变为**更新中**，并自动执行数据的均衡分布。该过程会发生数据迁移，因此变更配置的完成时间会较长。如果已知需要增加/减少的分片数，建议一次性完成，比一次只增加/减少一个分片效率更高。 

## 操作步骤

### 新增分片

> **说明**
>
> 新增分片时，表示同时新增N个分片及N个分片副本。

1. 登录 [QingCloud 管理控制台](https://console.qingcloud.com/login)。

2. 在控制台顶部的导航菜单中，选择**产品与服务** > **数据库与缓存** > **键值数据库 Redis**，进入 Redis Cluster 管理页面。

3. 点击目标集群 **ID** 号，进入集群详情页面。

4. 在页面右侧的**节点**页签，点击**新增分片**。

   <img src="../../../_images/add_shard.png" alt="新增分片" />

5. 填写新增分片的名称及数量，并设置节点 IP。

6. 点击**提交**。

### 新增副本

> **说明**
>
> 新增副本，表示在当前基础上，每个分片将再增加N个副本。

1. 登录 [QingCloud 管理控制台](https://console.qingcloud.com/login)。

2. 在控制台顶部的导航菜单中，选择**产品与服务** > **数据库与缓存** > **键值数据库 Redis**，进入 Redis Cluster 管理页面。

3. 点击目标集群 **ID** 号，进入集群详情页面。

4. 在页面右侧的**节点**页签，点击**新增副本**。

   <img src="../../../_images/add_shard_copy.png" alt="新增副本" />

5. 填写新增副本的名称及每个分片的副本数，并设置节点 IP。

6. 点击**提交**。

### 删除分片



> **说明**
>
> 删除分片，需要同时删除分片及其对应的所有副本。
>
> 以下情况不允许删除分片：
>
> ▪︎ 集群中存在状态异常的分片；
>
> ▪︎ 单节点的内存使用率大于 95%；
>
> ▪︎ 删除后，集群平均内存使用率大于 95% 。

1. 登录 [QingCloud 管理控制台](https://console.qingcloud.com/login)。

2. 在控制台顶部的导航菜单中，选择**产品与服务** > **数据库与缓存** > **键值数据库 Redis**，进入 Redis Cluster 管理页面。

3. 点击目标集群 **ID** 号，进入集群详情页面。

4. 在页面右侧的**节点**页签，勾选需要删除的分片及其对应的所有副本，点击**删除**。

5. 点击**确认**。

### 删除副本

> **说明**
>
> 删除副本时，需要在每个分片上删除均等数量的副本。

1. 登录 [QingCloud 管理控制台](https://console.qingcloud.com/login)。

2. 在控制台顶部的导航菜单中，选择**产品与服务** > **数据库与缓存** > **键值数据库 Redis**，进入 Redis Cluster 管理页面。

3. 点击目标集群 **ID** 号，进入集群详情页面。

4. 在页面右侧的**节点**页签，勾选需要副本，点击**删除**。

5. 点击**确认**。

