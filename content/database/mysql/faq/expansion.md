---
title: "扩容和升级"
description: 本小节主要介绍 MySQL Plus 扩容和升级常见问题。 
keyword: 数据库,MySQL PLus,关系型数据库,MySQL,扩容,升级问题
weight: 40
collapsible: false
draft: false
---

##  扩容是否会重启集群？

- 扩容磁盘仅伸缩普通磁盘大小，不重启服务，不影响业务。扩容 NeonSan 盘是先扩容从节点，再扩容主节点。

- 扩容 CPU 或内存，会按串行方式扩容。对于 1.5.5 及更高的版本，先扩容从节点，再扩容主节点，期间主从切换一次。

## 升级方式和升级路线

MySQL Plus 新形态从 1.0.1 版本开始支持滚动升级，即可跨版本升级。

节点升级顺序为先从后主。

## 升级过程中影响业务时间大概多久？

对于三个及以上节点数的集群，滚动升级中只会在最后升级主节点时造成主从切换，影响时间极短。

对于两个节点的集群，滚动升级中由于要保证数据一致性，影响时间稍长。

##  MySQL Plus 是否支持从普通版本升级到 NeonSAN 版本？

MySQL Plus 不支持从普通版本升级到 NeonSAN 大容量型版本。

用户可以通过 MySQL Plus 在线迁移服务来平滑迁移到 NeonSAN 版本。

## MySQL Plus 滚动升级失败怎么办？

MySQL Plus 支持滚动升级的版本一般情况下都可**正常升级**，但在以下一种情况下可能**升级失败**。

**同时满足以下三个条件**

1. 若升级之前应客户要求 从后台修改了升级前版本已经开放的且标注了“此项保存后数据库会重启”的参数。

2. 若升级目标版本新开放了配置参数到控制台。

3. 若新开放的配置参数在 升级前的版本无法识别，例如新版本安装了mysql插件并暴露了相关参数。

**排查**

1. 进入集群升级失败的节点查看 `/data/log/start.log` 确认是否 mysqld 状态异常。

2. 查看 `/data/mysql/mysql-error.log`（新形态1.0.6及以后版本为 `/data/mysql-log/mysql-error/mysql-error.log`），确认是否有 mysql 无法识别的参数导致启动失败。

3. 查看 `/data/log/updateparam.log` 查找关键字 "is not equal to" 前后日志，确认前后端不一致且引起重启的参数。

**处理**

直接 **关闭集群** 再 **启动集群**，自动完成升级，无需降级集群。
