---
title: "集群网络配置实践"
linkTitle: "多种网络配置"
date: 2021-10-15T10:08:56+09:00
description:
draft: false
weight: 2
---

在一个或多个集群的场景下，需要为集群和存储之间构建内部网络，需要远程访问的时候，需要创建公网IP，当前将为您介绍如果构建自己的网络，和如何配置公网IP，以及同一个公网IP如何通过端口转发实现访问多个集群，达到资源里，达到资源利用率的最大化，带宽可是随时扩容和缩容。

## 创建VPC网络和私有网络

1. 在VPC网络产品中，点击创建VPC网络，选择“小型”等网络类型，说明：集群不支持免费型

![image-20211019154008325](../_images/image-20211019154008325.png)

2. 系统会自动配置该vpc网络绑定的私有网络，点击创建VPC网络

   ![image-20211019154556326](../_images/image-20211019154556326.png)

3. 系统将创建小型的VPC网路并绑定了私有网络，状态为活跃时表示创建完成

   ![image-20211019154748884](../_images/image-20211019154748884.png)




## 创建公网IP

1. 公网IP页面创建公网IP，选择需要的带宽点击提交，说明：集群仅支持外部绑定模式的IP

   <img src="../_images/image-20211019154855351.png" style="zoom:50%;" />

2. 创建完成后会获得公网的IP

   <img src="../_images/image-20211019155022628.png" alt="image-20211019155022628" style="zoom:50%;" />



## 登录节点直接绑定公网IP

场景：一个集群一个登录节点的情况下

打开集群的列表，在登录节点右侧点击绑定公网IP，选择刚创建的公网IP即可，一个IP只能绑定一个登录节点



## 通过VPC网络绑定公网IP访问集群

通过VPC网络绑定公网IP，通过不同的端口号转发到内网IP，实现一个IP可以绑定多个集群

场景：多个集群使用同一个公网IP的情况下

1. VPC绑定公网IP，选择未分配的公网IP

   <img src="../_images/image-20211019155556218.png" alt="image-20211019155556218" style="zoom:50%;" />

2. 配置端口转发，点击VPC详情，选择“管理配置”标签的“端口转发” 页面，点击“添加规则”，填入端口号和内网IP

   ，源端口：22022，内网IP：登录节点的内网IP，内网端口22，点击提交

   <img src="../_images/image-20211019155752894.png" alt="image-20211019155752894" style="zoom:50%;" />

3. 配置防火墙放行规则，在vpc详情页面，点击默认的安全组，点击“添加安全组”，选择右侧“ssh”，系统将默认填写规则，指定刚设置的端口号即可，如22022，点击提交

   <img src="../_images/image-20211019155931144.png" alt="image-2021101915931144" style="zoom:50%;" />



<img src="../_images/image-20211019160112930.png" alt="image-20211019160112930" style="zoom:50%;" />

4. 提交完成后，将规则应用到VPC网络即可，就可以通过ip+端口号访问集群的登录节点了，其他登录节点也是通过添加同样的规则，指定不同的端口号即可，

   如mac 使用终端命令：ssh admin@[ip] -p 22022，windows 端使用 ssh admin@[ip] 22022

   [ip] 为实际的IP地址
