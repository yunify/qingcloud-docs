---
title: "公网ip带宽占用高排查方法"
date: 2021-03-08T21:37:25+09:00
description: Test description
weight: 50
draft: false
enableToc: false

---

## 1.检查公网ip带宽

●**登录到控制台，在公网ip监控中开启实时数据，查看当前一小时实时监控数据是否有异常升高，带宽被占满的情况。**



 ![eip](../_images/EIP1.png)



●**如带宽有占满情况，可以继续查看绑定的vpc或者云服务器网卡流量监控。如下是vpc网络监控，在vpc监控中查看私有网络的网卡监控数据，我们可以发现私有网络下资源进出流量数据，找到流量较高资源，排查是否为对外提供服务的资源，如果是可以参考下面云服务器排查方法，排查云服务器原因。**



 ![eip](../_images/EIP2.png)

## 2.windows服务器排查方法



●**我们按照上面查看网络监控的方法，基本可定位到引起带宽占用高的云服务器，然后控制台vnc登录到云服务器排查。**



 ![eip](../_images/EIP3.png)



●**云服务器中，选择【任务管理器】，打开 【任务管理器】 窗口
选择【性能】页签，单击【打开资源监视器】。如下图所示:** 

 ![eip](../_images/EIP4.png)



●**打开的 【资源监视器】 中，查看消耗带宽较多的进程，并根据您的实际业务，判断此进程是否正常。如下图所示：**

 ![eip](../_images/EIP5.png)



●**如果消耗带宽较多的进程为业务进程，则需要分析是否由于访问量变化引起，是否需要优化空间或者 升级服务器配置。**

●**如果消耗带宽较多的进程为异常进程，可能是病毒或木马导致，您可以自行终止进程或者使用安全软件进行查杀，也可以对数据备份后，重置系统。**





## 3.Linux服务器排查方法


●**我们按照上面查看网络监控的方法，基本可定位到引起带宽占用高的云服务器，然后控制台vnc登录到云服务器排查。**



 ![eip](../_images/EIP6.png)



●**执行以下命令，安装 iftop 工具。**

```
# yum install iftop -y
```



●**执行以下命令，安装 lsof。**



```
# yum install lsof -y
```



●**执行以下命令，运行 iftop。如下图所示：**



```
iftop
```
 ![eip](../_images/EIP7.png)

```
o<=、=> 表示流量的方向
oTX 表示发送流量
oRX 表示接收流量
oTOTAL 表示总流量
oCum 表示运行 iftop 到目前时间的总流量
opeak 表示流量峰值
orates 分别表示过去2s、10s和40s的平均流量
```



●**根据 iftop 中消耗流量的 IP，执行以下命令，查看连接该 IP 的进程。**



```
  # lsof -i | grep IP
```



●**如上图所示，消耗流量ip为 139.198.x.x  ，则执行下面命令**



```
lsof -i | grep  139.198.x.x
```



●**根据返回结果如下图，得知服务器带宽主要由apache服务进程消耗。**



 ![eip](../_images/EIP8.png)



**●看消耗带宽的进程，判断此进程是否正常。**

**●如果消耗带宽较多的进程为业务进程，则需要分析是否由于访问量变化引起，是否需要优化空间或者 升级服务器配置。**

**●如果消耗带宽较多的进程为异常进程，可能是病毒或木马导致，您可以自行终止进程或者使用安全软件进行查杀，也可以对数据备份后，重装系统。**