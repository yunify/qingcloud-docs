---
title: "文件系统管理"
date: 2021-07-19T00:38:25+09:00
description: 
draft: false
enableToc: false
weight: 1
keyword: 青云
---

用户可以通过Portal创建文件系统，并可以对已创建的文件系统进行管理操作，如获取文件系统详情及创建共享等。

## 创建文件系统

1. 使用正确的用户名和密码登录文件存储管理控制台。

2. 点击左侧**文件系统**，进入文件系统管理页面，点击**创建文件系统**。

   ![](../_images/File_system_management_1.png)

   或者在**概览**页面，点击**快速创建** ＞ **通用型NAS** ＞ **去创建**，进入**创建文件系统**页面。

   ![](../_images/File_system_management_2.png)

3. 弹出**创建文件系统**对话框，配置相关参数信息。

   ![](../_images/File_system_management_3.png)

**参数说明如下**：

- 可用区域：根据实际情况选择可用区域。

- 名称：输入待创建的文件系统名称，该名称需为集群唯一。

- 存储配额 ：设置该文件系统容量的最大值，设置为0即说明对该文件系统容量不作限制。

- 是否压缩：是否启用压缩功能，启用压缩功能可节省占用空间。

- 数据块大小：选择该文件系统下文件的最小IO单元。选择自动设置表示系统根据IO请求自动配置最优值，即根据文件的第一个IO请求大小去设置。数据块大小设置越大，顺序吞吐的性能越好。常见吞吐型场景下，若应用的IO方式不能确定，建议设置为64k。

- 预读数据块：选择该文件系统下文件预读时的最小数据单元，选择自动设置即表示系统根据IO请求自动配置最优值。

4. 点击**确定**后，页面跳转至文件系统管理页面，创建的文件系统显示在列。

   ![](../_images/File_system_management_4.png)

## 获取文件系统详情

1. 进入文件系统管理页面，点击需要查看的文件系统名称处链接，可查看文件系统详情。

2. 进入文件系统详情页面，左侧为该文件系统具体参数配置。

   ![](../_images/File_system_management_5.png)

## 修改文件系统

1. 进入文件系统管理页面，选择要修改的文件系统，点击**更多操作** ＞ **修改**。

   ![](../_images/File_system_management_6.png)

2. 弹出**修改文件系统**对话框，可对相应参数进行修改。

   ![](../_images/File_system_management_7.png)

 **参数说明如下**：

- 存储配额 ：设置该文件系统容量的最大值，设置为0即说明对该文件系统容量不作限制。

- 是否压缩：是否启用压缩功能，启用压缩功能可节省占用空间。

- 数据块大小：选择该文件系统下文件的最小IO单元。选择自动设置表示系统根据IO请求自动配置最优值，即根据文件的第一个IO请求大小去设置。数据块大小设置越大，顺序吞吐的性能越好。常见吞吐型场景下，若应用的IO方式不能确定，建议设置为64k。

- 预读数据块：选择该文件系统下文件预读时的最小数据单元，选择自动设置即表示系统根据IO请求自动配置最优值。

3. 修改完成后，点击**确定**，页面跳转至文件系统管理页面，修改后的文件系统显示在列。

## 删除文件系统

**前提条件：**

待删除的文件系统下，不能存在有文件与文件夹，当文件系统为空时才可成功删除，否则将删除失败。若删除失败，可参照[附录](#附录)进行操作。

**操作步骤：**

1. 进入文件系统管理页面，选择要修改的文件系统，点击**更多操作** ＞ **删除**。

   ![](../_images/File_system_management_8.png)

2. 弹出**删除文件系统**对话框，点击**确定**。

   ![](../_images/File_system_management_15.png)

3. 文件系统删除成功。

## 文件系统共享操作

### 创建共享

1. 进入文件系统管理页面，点击需要操作的文件系统名称，进入文件系统详情页面，点击**创建挂载点**。

   ![](../_images/File_system_management_9.png)

2. 弹出**创建挂载点**对话框，配置相关参数信息，配置完成后点击**确定**。

   ![](../_images/File_system_management_10.png)

**参数说明如下**：

- 协议类型：选择NFS/SMB，根据实际情况进行配置。

- 权限组：集群提供一个默认的NFS和SMB的权限组，如无特殊权限要求，可直接使用该默认权限组，也可提前创建所需权限组后再创建共享。

- 共享目录路径：/代表整个文件系统的根目录，/dir_name代表该文件系统下的一个子目录，用户无需手动创建该子目录，确认后系统将自动创建。

3. 点击**确定**后，回到文件系统详情页面，可看到挂载点创建成功。

### 修改共享

1. 在文件系统详情页面，选择需要更新的挂载点，点击**更多操作** ＞ **修改**。

   ![](../_images/File_system_management_11.png)

2. 弹出**修改挂载点**对话框，选择所需要使用的权限组后，点击**确定**。

   ![](../_images/File_system_management_12.png)

3. 挂载点即可更新成功。

### 删除共享

1. 在文件系统详情页面，选择需要删除的挂载点，点击**更多操作** ＞ **删除**。

   ![](../_images/File_system_management_13.png)

2. 弹出**删除挂载点**对话框，点击**确定**。

   ![](../_images/File_system_management_14.png)

3. 挂载点即可删除成功。

## 文件系统监控

1. 在文件系统详情页面，点击**资源监控**，进入监控页面，可以看到到该文件系统的存储使用量和Inode使用量。

   ![](../_images/File_system_management_16.png)

## 附录

### 文件系统无法删除解决方案

**原因分析：**

在文件系统下创建子挂载点时，页面会有提示自动创建目录，会在文件系统中创建一个目录文件。出于保护用户数据的考虑，删除子挂载点不会删除对应创建的目录，需用户主动删除。

**操作步骤：**

1. 登录Portal，点击待删除文件系统，进入文件系统详情页面，删除该文件系统下创建的所有共享。

2. 删除完成后，创建新的共享，共享目录路径设置为“/”。

3. 挂载步骤2中创建的共享，并进入查看是否有文件，删除查看到的文件。

   Step1：创建挂载目录
   ``` 
   mkdir /mnt/${test_create}
   ```
   Step2：复制管理控制台上的命令，修改最后的目录
   ```
   sudo mount -t nfs -o vers=3,nolock,proto=tcp n0.efs.qingstor.me:/test-create /mnt/${test_create}
   ```
   Step3：进入挂载目录
   ```
   cd /mnt/${test_create}
   ```
   Step4：查看文件
   ```
   ls
   ```
   Step5：删除文件
   ```
   rm -r *
   ```

4. 登录Portal，进入文件系统详情页面，删除步骤2中创建的共享。

5. 删除文件系统。
